---
title: "Partial Task: Write GitHub Issues"
subtitle: "Course DS 350"
author: "Bethany Ball"
keep-md: true
fig-width: 14
format:
  html:
    self-contained: true
    page-layout: full
    title-block-banner: true
    toc: true
    toc-depth: 3
    toc-location: body
    number-sections: false
    html-math-method: katex
    code-fold: true
    code-summary: "Show the code"
    code-overflow: wrap
    code-copy: hover
    code-tools:
        source: false
        toggle: true
        caption: See code
execute: 
  warning: false
editor: 
  markdown: 
    wrap: 72
editor_options: 
  chunk_output_type: console
---


```{r}
pacman::p_load(directlabels, gapminder, tidyverse, ggrepel, ggthemes, rio, plotly, nycflights13)
```

```{r}
age_data = flights %>% 
  left_join(planes, by = join_by(tailnum), suffix = c("_flight", "_mfct"))

age_data
```


```{r}
age_data = age_data %>% 
    left_join(planes, by = join_by(tailnum), suffix = c("_flight", "_mfct")) %>% 
    mutate(
      plane_age = (year_flight - year_mfct)) %>% 
    select(tailnum, plane_age, dep_delay, origin, carrier) %>% 
      drop_na %>% 
      mutate(
        age_group = case_when(
          plane_age < 11 ~ "0-10",
          plane_age < 21 ~ "11-20",
          plane_age < 31 ~ "21-30",
          TRUE ~ ">30"
        )
      )
    
names(age_data)
```


```{r}

ggplot(age_data, aes(x = plane_age, y = dep_delay, fill = origin)) +
  geom_area(alpha = 0.3) +
  labs(title = "Distribution of Departure Delays by Plane Age",
       x = "Plane Age (Years)",
       y = "Departure Delay (Minutes)",
       fill = "Origin") +
  theme_minimal()

age_data_with_airlines = age_data %>% 
  left_join(airlines, by = "carrier")

ggplot(age_data_with_airlines, aes(x = carrier, fill = age_group)) +
  geom_bar(position = "fill") +
  labs(title = "Distribution of Plane Age by Carrier",
       x = "Carrier",
       y = "Proportion",
       fill = "Age Group") +
  theme_minimal()

ggplot(age_data_with_airlines, aes(x = plane_age, y = dep_delay, color = carrier)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm") +
  labs(title = "Departure Delays vs Plane Age by Carrier",
       x = "Plane Age (Years)",
       y = "Departure Delay (Minutes)",
       color = "Carrier") +
  theme_minimal()

```


```{r}
average_delay_by_age_group = age_data %>%
  group_by(age_group) %>%
  summarize(average_dep_delay = mean(dep_delay, na.rm = TRUE)) %>%
  mutate(age_group = factor(age_group, levels = c("0-10", "11-20", "21-30", ">30")))

ggplot(average_delay_by_age_group, aes(x = age_group, y = average_dep_delay, fill = age_group)) +
  geom_bar(stat = "identity") +
  labs(title = "Average Departure Delays by Plane Age Group",
       x = "Plane Age Group",
       y = "Average Departure Delay (Minutes)",
       fill = "Age Group") +
  theme_minimal()
```

```{r}
average_delay_by_age = age_data %>%
  group_by(plane_age) %>%
  summarize(average_dep_delay = mean(dep_delay, na.rm = TRUE), .groups = 'drop')  

ggplot(average_delay_by_age, aes(x = plane_age, y = average_dep_delay)) +
  geom_line(color = "blue", size = 1) +  
  geom_point(color = "red") +  
  labs(
    title = "Average Departure Delays by Plane Age",
    x = "Plane Age (Years)",
    y = "Average Departure Delay (Minutes)"
  ) +
  theme_minimal()


```

The analysis is reather confusing, for some reason there is a big dip of older planes at one age. This is mmostly an outlier, however it is intoresting, beecouse it dose make is seame llike the younger the plane the worest iit is, but this is probably just becouse there are more younger planes and there aren't enought data points for the older planes...








